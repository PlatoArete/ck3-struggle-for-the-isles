# Agents Playbook: Struggle for the British Isles

## Purpose

Coordinate automation (Codex CLI) to scaffold, modify, and validate CK3 mod content for the 867-focused “Struggle for the British Isles”.

## Global Rules (HARD)

- Game target: CK3 (current stable). Do **not** overwrite vanilla files.
- Namespace all keys, files, and images with `isles_` (e.g., `isles_unity_value`, `isles_fyrd_maa`).
- Scope triggers/effects to Britannia unless explicitly told otherwise.
- Keep content additive; avoid redefining base game DB blocks.
- All new strings must have English localization stubs.

## Repo Structure (authoritative)

common/
struggles/
decisions/
buildings/
religions/
culture/
men_at_arms_types/
court_positions/
scripted_effects/
scripted_triggers/
scripted_values/
on_actions/
modifiers/
laws/
events/
gfx/interface/{icons,gui}/
localization/english/
defines/

## Naming Conventions

- Files: `00_isles_<topic>.txt` (e.g., `00_isles_buildings.txt`).
- Events: `isles.<series_id>.<ordinal>` (e.g., `isles.unity.0001`).
- Modifiers/decisions/CBs: `isles_<feature>_<specific>`.
- Loc keys mirror the script key: `isles_unity_of_the_isles_desc`.

## Agent Roles

### Agent: Scaffold

**Goal:** Create new content stubs with correct paths and names.
**Capabilities:** Add files, insert templates, append to lists, generate loc stubs.

**Templates**

- **Struggle phase block**
  - Path: `common/struggles/00_isles_struggle.txt`
  - Insert:
    ```txt
    phase = {
      name = isles_<phase_name>
      # TODO: momentum sources, modifiers, transitions
    }
    ```
- **Building level (Burh/Dún/Longphort)**
  - Path: `common/buildings/00_isles_buildings.txt`
  - Block name: `isles_building_<chain>_lvl_<n>`
  - Include: cost, time, triggers (culture/faith/terrain), effects, tooltip loc keys.
- **Decision**
  - Path: `common/decisions/00_isles_decisions.txt`
  - Key: `isles_<domain>_<action>`
  - Include: `is_shown`, `is_valid`, `effect`, `ai_will_do`.
- **Men-at-Arms**
  - Path: `common/men_at_arms_types/00_isles_maa.txt`
  - Key: `isles_maa_<unit>`
  - Include: stats, counters, terrain modifiers, unlock (innovation/decision).

- **Event**
  - Path: `events/isles_<domain>_events.txt`
  - ID: `isles.<domain>.<####>`
  - Include: `trigger`, `immediate`, options (A/B), and loc keys.

- **Scripted Value/Effect**
  - Paths: `common/scripted_values/00_isles_values.txt`, `common/scripted_effects/00_isles_effects.txt`
  - Key: `isles_<thing>`

### Agent: Validator

**Goal:** Guardrails & checks before commit.
**Run:**

- Syntax check for paradox txt (balanced braces).  
- Verify no vanilla file paths touched.  
- Ensure **every** script key has a matching `l_english` entry.  
- Ensure `isles_` prefix present.  
- Ensure events have unique IDs; no duplicate `isles.<domain>.<####>`.  
- Men-at-Arms counters reference valid unit types.  
- Buildings: each level forms a continuous chain; triggers compile.

### Agent: Localizer

**Goal:** Maintain localization coverage.
**Actions:**

- For every new key, create placeholders in `localization/english/isles_l_english.yml`:

isles_<key>:0 "TODO: $KEY$"

- Keep short/long desc variants where needed: `_desc`, `_tt` (tooltip), `_effect`.

### Agent: Integrator

**Goal:** Wire systems together coherently.
**Tasks:**

- Hook Unity monthly update:
- Add `on_monthly_pulse` → `isles_unity_monthly_update` in `common/on_actions/zz_isles_unity_on_actions.txt`.
- Add struggle transitions when thresholds met.
- Ensure decisions fire events and add/remove realm modifiers.

## Common Recipes

### Recipe: Add Unity Threshold Event

1. Append event block to `events/isles_unity_events.txt` with ID `isles.unity.00NN`.
2. Conditions: `check_variable = { isles_unity_value >= <n> }` and `has_variable_flag != shown_<n>`.
3. Effects: add realm modifier, set flag, fire flavor text.
4. Add loc keys for title, desc, options.

### Recipe: New Levy System

1. Add realm modifier in `common/modifiers/00_isles_levies.txt` (stats deltas).
2. Gate via decision or innovation.
3. Hook additive MaA synergy (e.g., +damage if county has Burh).

### Recipe: New Confederation Council Meeting

1. Event `isles.confed.1xxx`: agenda selection, AI weights.
2. Apply ± Unity & Stability variables.
3. Optional votes via `character_event` chains to member rulers.

## Style & Quality

- Indentation: 2 spaces, no tabs.
- One feature per PR.
- Keep comments brief: `# WHY` not `# WHAT`.
- Add a minimal changelog entry in `README.md` under **Changelog**.

## CI / Commands (suggested)

- `codex run scaffold <feature>` – creates files from templates.
- `codex run validate` – runs all checks.
- `codex run loc-sync` – ensures localization placeholders exist.
- `codex run link-unity` – injects on_action/values for Unity system.

## Do Not Do (agents)

- Do not rename or move existing non-empty files without explicit instruction.
- Do not add content outside `isles_` namespace.
- Do not create content without localization stubs.
